---
alwaysApply: true
---

# Правила документирования кода и использования документации

## 1. Общие принципы документирования

### 1.1. Обязательность документации

- **Все публичные API** (функции, классы, интерфейсы, типы) должны иметь JSDoc комментарии
- **Все экспортируемые сущности** должны быть задокументированы
- **Сложная бизнес-логика** должна иметь пояснения
- **Неочевидные решения** должны быть объяснены

### 1.2. Формат JSDoc

Используйте стандартный формат JSDoc с тегами:

```typescript
/**
 * Краткое описание функции/класса/типа (одна строка).
 * 
 * Дополнительное описание, если нужно объяснить детали работы,
 * особенности реализации или важные нюансы.
 * 
 * @param paramName Описание параметра.
 * @param paramName2 Описание второго параметра.
 * @returns Описание возвращаемого значения.
 * @throws {ErrorType} Когда и почему выбрасывается ошибка.
 * @example
 * const result = functionName('value');
 * console.log(result); // 'output'
 */
```

## 2. Правила документирования по типам сущностей

### 2.1. Функции и методы

**Обязательные элементы:**
- Краткое описание назначения функции
- `@param` для каждого параметра (если есть)
- `@returns` описание возвращаемого значения
- `@throws` если функция может выбросить ошибку
- `@example` для сложных или важных функций

**Пример:**
```typescript
/**
 * Выполняет запрос на вход пользователя.
 * @param params Данные формы входа, предварительно валидированные.
 * @returns Ответ API с данными пользователя и токенами авторизации.
 * @throws {Error} Если неверные учётные данные или произошла ошибка сети.
 * @example
 * const response = await login({
 *   email: 'admin@example.com',
 *   password: 'securePassword123'
 * });
 * console.log(response.user.name); // 'Администратор'
 */
export const login = async (params: ZLoginDto): Promise<ZLoginResponse> => {
  // ...
};
```

### 2.2. Классы и сторы

**Обязательные элементы:**
- Описание назначения класса
- Описание публичных свойств (если они важны)
- Описание публичных методов
- Описание флагов состояния (pending, error и т.д.)

**Пример:**
```typescript
/**
 * Store для управления состоянием авторизации администратора.
 * Обеспечивает операции входа/выхода и хранение данных текущего пользователя.
 */
export class AuthStore {
  /**
   * Флаг выполнения запроса релогина.
   * Устанавливается в `true` при проверке текущей авторизации.
   */
  relogin = false;
  
  /**
   * Флаг выполнения асинхронной операции.
   * Используется для отображения состояния загрузки в UI.
   */
  pending = false;
  
  /**
   * Данные текущего авторизованного пользователя.
   * `null` если пользователь не авторизован.
   */
  user: ZAuthUser | null = null;
  
  /**
   * Выполняет попытку входа и обновляет состояние в зависимости от результата.
   * @param dto Данные формы входа.
   * @returns `true`, если вход выполнен успешно.
   */
  async login(dto: ZLoginDto): Promise<boolean> {
    // ...
  }
}
```

### 2.3. Типы и интерфейсы

**Обязательные элементы:**
- Описание назначения типа
- Описание каждого поля (если тип сложный)
- Пример использования для сложных типов

**Пример:**
```typescript
/**
 * Схема валидации данных для входа пользователя.
 * @example
 * const loginData: ZLoginDto = {
 *   email: 'admin@example.com',
 *   password: 'securePassword123'
 * };
 */
export const zLoginDto = z.object({
  /** Email пользователя. Должен быть валидным email адресом. */
  email: z.email(),
  /** Пароль пользователя. Минимум 8 символов. */
  password: z.string().min(8),
});
```

### 2.4. React компоненты

**Обязательные элементы:**
- Описание назначения компонента
- Описание пропсов (через JSDoc на типе пропсов)
- Описание поведения компонента (если неочевидно)

**Пример:**
```typescript
/**
 * Пропсы компонента поля ввода slug.
 */
export type PropsSlugInput = Omit<InputProps, 'onChange'> & {
  /** Исходное значение для генерации slug. */
  from: string;
  /** Обработчик изменения значения slug. */
  onChange?: (value: string) => void;
  /** Запрещает автоматическую генерацию slug при изменении исходного значения. */
  holdOnChange?: boolean;
};

/**
 * Поле ввода slug с автоматической генерацией из исходного значения через API.
 * При изменении поля `from` автоматически генерирует slug, если пользователь не редактировал поле вручную.
 */
export const SlugInput: React.FC<PropsSlugInput> = ({ from, onChange, holdOnChange, ...props }) => {
  // ...
};
```

### 2.5. Утилиты

**Обязательные элементы:**
- Описание что делает функция
- Описание параметров и возвращаемого значения
- Пример использования

**Пример:**
```typescript
/**
 * Объединяет переданные CSS-классы в одну строку.
 * Отфильтровывает ложные значения, чтобы исключить неожиданные пробелы.
 * @param classes Перечень классов и условных значений.
 * @returns Единую строку классов.
 * @example
 * joinClassNames('btn', isActive && 'active', undefined, 'primary')
 * // 'btn active primary'
 */
export const joinClassNames = (...classes: Array<string | false | undefined>): string =>
  classes.filter(Boolean).join(' ');
```

## 3. Правила актуальности документации

### 3.1. При изменении кода

- **ВСЕГДА** обновляйте JSDoc комментарии при изменении сигнатуры функции/метода
- **ВСЕГДА** обновляйте описания параметров, если они изменились
- **ВСЕГДА** обновляйте примеры, если они устарели
- **ВСЕГДА** добавляйте `@throws` если добавили новую ошибку

### 3.2. При добавлении новой функциональности

- **ВСЕГДА** документируйте новые публичные функции/классы/типы
- **ВСЕГДА** добавляйте примеры для сложных API
- **ВСЕГДА** документируйте новые параметры в существующих функциях

### 3.3. Автоматическая генерация документации

- Документация генерируется автоматически при коммите через `lint-staged`
- Если документация не сгенерировалась, запустите `npm run docs:gen`
- **НЕ коммитьте** изменения в `docs/api/`, `docs/components/`, `docs/pages/` без запуска генерации

## 4. Правила использования документации

### 4.1. Перед написанием нового кода

1. **Проверьте существующую документацию:**
   - Запустите `npm run docs:dev`
   - Изучите раздел API для понимания доступных функций
   - Изучите раздел Компоненты для понимания доступных UI компонентов
   - Изучите раздел Типы для понимания структуры данных

2. **Используйте примеры из документации:**
   - Копируйте примеры использования из JSDoc комментариев
   - Адаптируйте примеры под вашу задачу

### 4.2. При работе с API

1. **Изучите типы:**
   - Проверьте `src/types/` для понимания структуры данных
   - Используйте Zod схемы для валидации

2. **Используйте правильные функции:**
   - Проверьте документацию API функций в `docs/api/`
   - Используйте примеры из `@example` тегов

3. **Обрабатывайте ошибки:**
   - Изучите `@throws` теги для понимания возможных ошибок
   - Используйте `onError` утилиту для обработки ошибок

### 4.3. При работе с компонентами

1. **Изучите пропсы:**
   - Проверьте документацию компонентов в `docs/components/`
   - Используйте типы пропсов из JSDoc

2. **Используйте примеры:**
   - Копируйте примеры использования компонентов
   - Адаптируйте под вашу задачу

### 4.4. При работе со сторами

1. **Изучите публичные методы:**
   - Проверьте документацию сторов в `docs/api/`
   - Используйте правильные методы для работы с состоянием

2. **Понимайте флаги состояния:**
   - Изучите описание флагов (pending, error, relogin и т.д.)
   - Используйте их для правильного отображения UI

## 5. Проверка актуальности документации

### 5.1. Перед коммитом

1. **Запустите генерацию:**
   ```bash
   npm run docs:gen
   ```

2. **Проверьте изменения:**
   - Убедитесь, что документация обновилась
   - Проверьте, что примеры актуальны
   - Убедитесь, что ссылки работают

3. **Запустите dev-сервер:**
   ```bash
   npm run docs:dev
   ```
   - Проверьте, что страницы открываются
   - Проверьте, что примеры отображаются корректно

### 5.2. В CI/CD

- CI автоматически проверяет актуальность документации
- Если документация устарела, CI упадёт с ошибкой
- **НЕ игнорируйте** ошибки CI связанные с документацией

## 6. Стиль документации

### 6.1. Язык

- Используйте **русский язык** для документации
- Пишите **ясно и кратко**
- Избегайте технического жаргона без объяснений

### 6.2. Структура комментариев

1. **Первая строка** - краткое описание (до 80 символов)
2. **Пустая строка**
3. **Дополнительное описание** (если нужно)
4. **Теги JSDoc** (`@param`, `@returns`, `@throws`, `@example`)

### 6.3. Примеры

- Примеры должны быть **реалистичными**
- Примеры должны **работать** (можно скопировать и использовать)
- Примеры должны показывать **типичное использование**

### 6.4. Описания параметров

- Начинайте с **заглавной буквы**
- Заканчивайте **точкой** (если описание длинное)
- Указывайте **тип** если неочевидно
- Указывайте **ограничения** (минимум, максимум, формат)

## 7. Запреты

### 7.1. НЕ делайте

- ❌ НЕ документируйте очевидные вещи (`/** Устанавливает значение */ setValue(value: string)`)
- ❌ НЕ копируйте документацию без проверки актуальности
- ❌ НЕ оставляйте устаревшие примеры
- ❌ НЕ документируйте приватные методы/свойства (используйте `@private` если нужно)
- ❌ НЕ используйте `any` без объяснения в документации

### 7.2. Делайте

- ✅ Документируйте **публичные API**
- ✅ Обновляйте документацию **при изменении кода**
- ✅ Добавляйте **примеры** для сложных функций
- ✅ Описывайте **поведение**, а не только сигнатуру
- ✅ Указывайте **ограничения** и **предусловия**

## 8. Примеры хорошей документации

### 8.1. Хорошо документированная функция

```typescript
/**
 * Генерирует slug из заголовка через API.
 * Создаёт URL-friendly строку из текста и проверяет уникальность.
 * @param title Заголовок для преобразования в slug.
 * @param postType Опциональный slug типа записи для проверки уникальности в рамках этого типа.
 * @returns Объект с базовым и уникальным slug (если базовый уже занят).
 * @example
 * const result = await slugify('Моя первая статья');
 * console.log(result.base); // 'moya-pervaya-statya'
 * console.log(result.unique); // 'moya-pervaya-statya-1' (если базовый занят)
 */
export const slugify = async (title: string, postType?: string): Promise<ZSlugifyResponse> => {
  // ...
};
```

### 8.2. Хорошо документированный тип

```typescript
/**
 * Схема валидации типа контента CMS.
 * Тип контента определяет структуру и настройки для записей определённого вида.
 * @example
 * const postType: ZPostType = {
 *   slug: 'article',
 *   name: 'Статья',
 *   template: 'article-template',
 *   options_json: { allowComments: true },
 *   created_at: '2024-01-01T00:00:00Z',
 *   updated_at: '2024-01-02T00:00:00Z'
 * };
 */
export const zPostType = z.object({
  /** Уникальный идентификатор типа контента (URL-friendly строка). */
  slug: z.string(),
  /** Отображаемое название типа контента. */
  name: z.string(),
  /** Имя шаблона для рендеринга записей этого типа. Может быть `null`. */
  template: z.string().optional().nullable(),
  // ...
});
```

## 9. Чеклист перед коммитом

- [ ] Все новые публичные функции/классы/типы задокументированы
- [ ] Все изменённые функции имеют обновлённую документацию
- [ ] Примеры в документации актуальны и работают
- [ ] Запущена генерация документации (`npm run docs:gen`)
- [ ] Проверена документация в dev-сервере (`npm run docs:dev`)
- [ ] Нет устаревших комментариев
- [ ] Все `@param`, `@returns`, `@throws` теги заполнены

## 10. Полезные команды

```bash
# Генерация всей документации
npm run docs:gen

# Генерация только API документации
npm run docs:gen:api

# Генерация только документации компонентов
npm run docs:gen:components

# Генерация только карты страниц
npm run docs:gen:pages

# Запуск dev-сервера документации
npm run docs:dev

# Сборка документации для production
npm run docs:build

# Предпросмотр собранной документации
npm run docs:preview
```
